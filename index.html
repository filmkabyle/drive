<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÙˆÙ„Ø¯ Ø£Ø¯Ø§Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±ÙˆØ§Ø¨Ø· Drive</title>
    <style>
        body { font-family: system-ui, sans-serif; background-color: #f0f2f5; color: #333; text-align: center; padding: 20px; line-height: 1.6; }
        .container { max-width: 700px; margin: auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        h1 { color: #1a73e8; }
        p.intro { font-size: 1.1em; color: #5f6368; }
        .input-section { margin: 30px 0; }
        input[type="url"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
            text-align: left;
            direction: ltr;
            transition: border-color 0.3s;
        }
        input[type="url"]:focus { border-color: #1a73e8; outline: none; }
        #tool-container { margin-top: 25px; padding: 20px; border-radius: 10px; background-color: #fce8e6; display: none; }
        #tool-container p { font-weight: bold; }
        #generated-tool {
            display: inline-block;
            padding: 12px 25px;
            background-color: #d93025;
            color: white;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            transition: background-color 0.3s;
        }
        #generated-tool:hover { background-color: #c5221f; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ù…ÙˆÙ„Ø¯ Ø£Ø¯Ø§Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</h1>
        <p class="intro">
            Ø¨Ø³Ø¨Ø¨ Ù‚ÙˆØ§Ù†ÙŠÙ† Ø£Ù…Ø§Ù† Ø§Ù„Ù…ØªØµÙØ­ØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©.
            <br>
            Ù„ÙƒÙ†ØŒ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ù‡Ù†Ø§ Ø¨Ù†Ø§Ø¡ **"Ø£Ø¯Ø§Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø®ØµØµØ©"** Ù„ÙƒÙ„ Ø±Ø§Ø¨Ø·.
        </p>

        <div class="input-section">
            <label for="gdrive-url" style="font-weight: bold; display: block; margin-bottom: 10px;">Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ù„ØµÙ‚ Ø±Ø§Ø¨Ø· Google Drive Ù‡Ù†Ø§</label>
            <input type="url" id="gdrive-url" placeholder="https://drive.google.com/file/d/..." oninput="generateTool()">
        </div>

        <div id="tool-container">
            <p>Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø²Ø± Ù„ÙØªØ­ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙˆØ§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</p>
            <a id="generated-tool" href="#" target="_blank">Ø§ÙØªØ­ ÙˆØ§Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ğŸš€</a>
        </div>
    </div>

    <script>
        function generateTool() {
            const urlInput = document.getElementById('gdrive-url');
            const toolContainer = document.getElementById('tool-container');
            const generatedTool = document.getElementById('generated-tool');
            
            const gdriveUrl = urlInput.value.trim();

            if (!gdriveUrl.includes('drive.google.com/file/d/')) {
                toolContainer.style.display = 'none';
                return;
            }

            // Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø°ÙŠ Ø³ÙŠØªÙ… ØªÙ†ÙÙŠØ°Ù‡ Ø¨Ø¹Ø¯ ÙØªØ­ ØµÙØ­Ø© Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ
            const extractionCode = `
                (function() {
                    function showResults(links) {
                        let overlay = document.getElementById('extractor-overlay-final');
                        if (overlay) overlay.remove();
                        overlay = document.createElement('div');
                        overlay.id = 'extractor-overlay-final';
                        overlay.style.cssText = 'position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.75); z-index:999999; display:flex; justify-content:center; align-items:center;';
                        const modal = document.createElement('div');
                        modal.style.cssText = 'background:white; padding:25px; border-radius:10px; width:90%; max-width:550px; font-family:sans-serif; text-align:right;';
                        let content = '<h3>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±ÙˆØ§Ø¨Ø·.</h3><p>ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù„ÙŠØ³ Ø®Ø§ØµÙ‹Ø§ ÙˆØ£Ù† Ø§Ù„ØµÙØ­Ø© Ù‚Ø¯ ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.</p>';
                        if (links && links.length > 0) {
                            content = '<h3>Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø© Ø¨Ù†Ø¬Ø§Ø­:</h3>';
                            links.forEach(link => {
                                if (link.url) {
                                    content += \`<div style="display:flex; justify-content:space-between; align-items:center; padding:10px; border-bottom:1px solid #eee; direction:ltr;">
                                        <strong>\${link.quality}p</strong>
                                        <input type="text" value="\${link.url}" readonly style="width:60%; border:1px solid #ccc; padding:5px; font-size:12px;">
                                        <button onclick="navigator.clipboard.writeText('\${link.url}').then(() => this.innerText = 'ØªÙ…!')">Ù†Ø³Ø®</button>
                                    </div>\`;
                                }
                            });
                        }
                        const closeBtn = document.createElement('button');
                        closeBtn.innerText = 'Ø¥ØºÙ„Ø§Ù‚';
                        closeBtn.style.cssText = 'display:block; margin:20px auto 0 auto; padding:10px 20px; cursor:pointer; font-weight:bold;';
                        closeBtn.onclick = () => overlay.remove();
                        modal.innerHTML = content;
                        modal.appendChild(closeBtn);
                        overlay.appendChild(modal);
                        document.body.appendChild(overlay);
                    }

                    try {
                        const pageSource = document.documentElement.innerHTML;
                        const dataMatch = pageSource.match(/WIZ_global_data\\s*=\\s*({.+?});/);
                        if (!dataMatch) throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (WIZ_global_data).');
                        
                        const data = JSON.parse(dataMatch[1]);
                        
                        function findStreams(obj) {
                            if (typeof obj !== 'object' || obj === null) return null;
                            if (Array.isArray(obj)) {
                                const item = obj[0];
                                if (typeof item === 'object' && item !== null && typeof item['2'] === 'string' && item['2'].startsWith('http') && typeof item['4'] === 'number') {
                                    return obj;
                                }
                            }
                            for (const key in obj) {
                                const result = findStreams(obj[key]);
                                if (result) return result;
                            }
                            return null;
                        }

                        const streamData = findStreams(data);
                        if (!streamData) throw new Error('ÙØ´Ù„ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ ÙÙŠ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.');

                        const links = streamData.map(s => ({ quality: s['4'], url: s['2'] }));
                        showResults(links);
                    } catch (e) {
                        alert('Ø®Ø·Ø£: ' + e.message);
                    }
                })();
            `;

            // Ø®Ø¯Ø¹Ø© Ø°ÙƒÙŠØ©: Ù†ÙØªØ­ Ø±Ø§Ø¨Ø· Ø¬ÙˆØ¬Ù„ØŒ ÙˆØ¨Ø¹Ø¯ 2.5 Ø«Ø§Ù†ÙŠØ© (Ù„ÙŠÙƒÙˆÙ† Ù‚Ø¯ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©)ØŒ Ù†Ù†ÙØ° ÙƒÙˆØ¯ Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬
            const finalJsCode = `
                window.open('${gdriveUrl}', '_blank');
                alert('Ø³ÙŠØªÙ… ÙØªØ­ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Ø¬Ø¯ÙŠØ¯. Ø¨Ø¹Ø¯ Ø£Ù† ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŒ Ø§Ø±Ø¬Ø¹ Ø¥Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ ÙˆØ§Ø¶ØºØ· "Ù…ÙˆØ§ÙÙ‚" Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬.');
                setTimeout(function() {
                    ${extractionCode}
                }, 2500);
            `;
            
            // Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ÙŠÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø«Ù… ÙŠØ­Ø§ÙˆÙ„ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©. Ù‡Ø°Ø§ Ù„Ø§ ÙŠØ¹Ù…Ù„ Ø¬ÙŠØ¯Ù‹Ø§.
            // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø£Ø¨Ø³Ø· ÙˆØ§Ù„Ø£ÙƒØ«Ø± Ø¶Ù…Ø§Ù†Ù‹Ø§ Ù‡ÙŠ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù€ Bookmarklet.
            // Ø³Ø£Ù‚ÙˆÙ… Ø¨ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ù†Ø·Ù‚ Ù„ÙŠÙƒÙˆÙ† ÙˆØ§Ø¶Ø­Ù‹Ø§ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù….

            const bookmarkletCode = `javascript: ${encodeURIComponent(`(function(){${extractionCode.trim()}})()`)}`;

            // ØªØ­Ø¯ÙŠØ« Ù…Ù†Ø·Ù‚ Ø§Ù„ØµÙØ­Ø© Ù„ÙŠÙƒÙˆÙ† Ø£ÙƒØ«Ø± ØµØ¯Ù‚Ù‹Ø§
            generatedTool.href = bookmarkletCode;
            generatedTool.onclick = function(e) {
                e.preventDefault();
                alert('Ø®Ø·Ø£: Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø²Ø± Ù…Ø¨Ø§Ø´Ø±Ø©.\\n\\nØ§Ù„Ø±Ø¬Ø§Ø¡ Ø³Ø­Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ø²Ø± Ø¥Ù„Ù‰ Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ©ØŒ Ø«Ù… Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙˆØ§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ© Ù‡Ù†Ø§Ùƒ.');
            };

            const toolContainerText = document.querySelector('#tool-container p');
            toolContainerText.innerHTML = `Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø§Ù„Ø¢Ù†ØŒ <strong>Ø§Ø³Ø­Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ø²Ø±</strong> Ø¥Ù„Ù‰ Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ©. <br> Ø«Ù… Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙˆØ§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ© Ø§Ù„ØªÙŠ Ø­ÙØ¸ØªÙ‡Ø§.`;
            generatedTool.innerText = `Ø§Ø³Ø­Ø¨Ù†ÙŠ ğŸš€`;
            toolContainer.style.display = 'block';
        }
    </script>
</body>
</html>
